# Arch-OS X Maintainer: Sean Yeh <snoblo at archlinux dot us>
# $Id: PKGBUILD 76140 2010-04-07 22:28:05Z pierre $
# Maintainer: Pierre Schmitz <pierre@archlinux.de>

pkgname=ca-certificates
pkgver=20090814
pkgrel=3
pkgdesc='Common CA certificates'
arch=('any')
url='http://packages.qa.debian.org/c/ca-certificates.html'
license=('MPL' 'GPL')
source=("http://ftp.debian.org/debian/pool/main/c/${pkgname}/${pkgname}_${pkgver}.tar.gz")
depends=('bash' 'run-parts' 'openssl' 'findutils' 'coreutils' 'sed')
makedepends=('ruby' 'python')
install=ca-certificates.install
backup=('opt/arch/etc/ca-certificates.conf')
md5sums=('307052c985bec7f9a00eb84293eef779')

build() {
	cd ${srcdir}/${pkgname}-${pkgver}

	sed -i~ -e 's^/usr/share^/opt/arch/share^g' Makefile
	sed -i~ -e 's^/usr/sbin^/opt/arch/sbin^g' sbin/Makefile
	sed -i~ -e 's^/etc^/opt/arch/etc^g' sbin/*

	install -d -m755 $pkgdir/{opt/arch/etc/ca-certificates/update.d,opt/arch/{sbin,share/ca-certificates},opt/arch/etc/ssl/certs}
	install -D -m644 opt/arch/sbin/update-ca-certificates.8 $pkgdir/opt/arch/share/man/man8/update-ca-certificates.8
	make
	make install DESTDIR=$pkgdir

	(
	echo "# Automatically generated by ${pkgname}-${pkgver}-${pkgrel}"
	echo "# see update-ca-certificates man page"
	echo "# "
	cd $pkgdir/opt/arch/share/ca-certificates
	find . -name '*.crt' | sort | cut -b3-
	) > $pkgdir/opt/arch/etc/ca-certificates.conf
}
